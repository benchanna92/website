<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monthly Sales Tracking</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --color-primary: #111827;
      --color-text: #374151;
      --color-gray-light: #f9fafb;
      --color-gray-medium: #6b7280;
      --color-bg: #ffffff;
      --radius: 0.75rem;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      --transition: 0.3s ease;
      --footer-bg: #f9fafb;
      --footer-text: #6b7280;
      --action-color: #6b7280;
      --action-hover: #111827;
      --button-bg-error: #ef4444;
      --button-bg-error-hover: #b91c1c;
      --button-bg-primary: var(--color-primary);
      --button-bg-primary-hover: #374151;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    header {
      position: sticky;
      top: 0;
      background: var(--color-bg);
      border-bottom: 1px solid #e5e7eb;
      box-shadow: var(--shadow);
      z-index: 100;
    }

    nav {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-weight: 800;
      font-size: 48px;
      color: var(--color-primary);
      user-select: none;
      letter-spacing: 0.05em;
    }

    main {
      max-width: 1200px;
      margin: 4rem auto 4rem;
      padding: 0 2rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    h1 {
      font-weight: 800;
      font-size: 48px;
      margin-bottom: 0.75rem;
      color: var(--color-primary);
      user-select: none;
    }

    h2 {
      font-weight: 700;
      font-size: 24px;
      margin-bottom: 1.25rem;
    }

    .text-muted {
      color: var(--color-gray-medium);
      font-size: 18px;
      margin-bottom: 1rem;
    }

    .tabs {
      display: flex;
      gap: 1.25rem;
      margin-bottom: 1rem;
      user-select: none;
    }

    .tab {
      padding: 0.6rem 1.75rem;
      font-weight: 700;
      font-size: 18px;
      color: var(--color-gray-medium);
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: color var(--transition), border-color var(--transition);
      background: none;
      border-radius: var(--radius) var(--radius) 0 0;
      user-select: none;
    }

    .tab[aria-selected="true"] {
      color: var(--color-primary);
      border-color: var(--color-primary);
      cursor: default;
    }

    form {
      background: var(--color-gray-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.75rem 2rem;
      max-width: 480px;
      width: 100%;
      font-size: 18px;
    }

    label {
      display: block;
      font-weight: 700;
      margin-bottom: 0.35rem;
      color: var(--color-primary);
    }

    input[type="text"],
    input[type="password"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 18px;
      border: 1.5px solid #d1d5db;
      border-radius: var(--radius);
      transition: border-color var(--transition);
      font-family: 'Inter', system-ui, sans-serif;
      margin-bottom: 1.25rem;
      color: var(--color-primary);
      background-color: #fff;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.15);
      background-color: #fff;
    }

    button {
      background-color: var(--button-bg-primary);
      color: white;
      font-weight: 700;
      border: none;
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      font-size: 20px;
      cursor: pointer;
      transition: background-color var(--transition), transform var(--transition);
      user-select: none;
      width: 100%;
      letter-spacing: 0.02em;
    }
    button:hover,
    button:focus {
      background-color: var(--button-bg-primary-hover);
      transform: scale(1.05);
      outline: none;
    }

    .login-register-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 70vh;
      width: 100%;
      max-width: 480px;
    }

    .dashboard {
      display: none;
      flex-direction: column;
      width: 100%;
      max-width: 1200px;
    }

    .summary {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
      margin-bottom: 2.5rem;
      justify-content: center;
    }

    .card {
      background: var(--color-gray-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.75rem;
      flex: 1;
      min-width: 180px;
      max-width: 320px;
      color: var(--color-primary);
      text-align: center;
      user-select: none;
      font-size: 20px;
    }

    .card h3 {
      margin: 0 0 0.75rem 0;
      font-weight: 800;
      font-size: 24px;
    }

    .chart-section {
      background: var(--color-gray-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.75rem 2rem;
      max-width: 800px;
      margin: 0 auto 3rem;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .chart-tabs {
      display: flex;
      gap: 2rem;
      margin-bottom: 1.5rem;
      user-select: none;
    }

    .chart-tab {
      padding: 0.6rem 1.75rem;
      font-weight: 700;
      font-size: 20px;
      color: var(--color-gray-medium);
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: color var(--transition), border-color var(--transition);
      background: none;
      border-radius: var(--radius) var(--radius) 0 0;
      min-width: 110px;
      text-align: center;
      user-select: none;
    }
    .chart-tab[aria-selected="true"] {
      color: var(--color-primary);
      border-color: var(--color-primary);
      cursor: default;
    }

    canvas {
      width: 100% !important;
      max-width: 800px;
      height: 400px !important;
      user-select: none;
    }

    .logout-btn {
      align-self: flex-end;
      margin-bottom: 2rem;
      padding: 0.6rem 1.25rem;
      font-size: 18px;
      background-color: var(--button-bg-error);
      max-width: 140px;
      user-select: none;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background-color var(--transition), transform var(--transition);
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    .logout-btn:hover,
    .logout-btn:focus {
      background-color: var(--button-bg-error-hover);
      transform: scale(1.05);
      outline: none;
    }

    /* Sales list table styling */
    .sales-list-card {
      background: var(--color-gray-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 2rem;
      max-width: 800px;
      width: 100%;
      margin-bottom: 3rem;
    }

    .sales-list-card h2 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      user-select: none;
      font-weight: 800;
      font-size: 28px;
      color: var(--color-primary);
    }

    table.sales-list {
      width: 100%;
      border-collapse: collapse;
      font-size: 18px;
      user-select: text;
    }
    table.sales-list thead {
      background-color: #e5e7eb;
    }
    table.sales-list th, table.sales-list td {
      padding: 1rem 1.25rem;
      text-align: left;
      border-bottom: 1px solid #d1d5db;
      vertical-align: middle;
    }
    table.sales-list tbody tr:hover {
      background-color: #f3f4f6;
    }

    /* Action buttons in table */
    .action-btn {
      background: none;
      border: none;
      color: var(--action-color);
      cursor: pointer;
      padding: 0.3rem 0.6rem;
      margin-left: 0.5rem;
      font-weight: 700;
      font-size: 16px;
      border-radius: var(--radius);
      transition: color var(--transition), background-color var(--transition);
      user-select: none;
      vertical-align: middle;
      line-height: 1;
    }
    .action-btn:hover,
    .action-btn:focus {
      color: var(--action-hover);
      background-color: rgba(17, 24, 39, 0.1);
      outline: none;
    }

    /* Inline edit inputs */
    .edit-input {
      width: 100%;
      font-size: 18px;
      font-family: inherit;
      padding: 0.3rem 0.5rem;
      border: 1.5px solid #d1d5db;
      border-radius: var(--radius);
      transition: border-color var(--transition);
    }
    .edit-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.15);
    }

    /* Edit actions container */
    .edit-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-start;
    }
    .save-btn {
      background-color: var(--button-bg-primary);
      color: white;
      border: none;
      padding: 0.4rem 0.9rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: background-color var(--transition), transform var(--transition);
    }
    .save-btn:hover,
    .save-btn:focus {
      background-color: var(--button-bg-primary-hover);
      outline: none;
      transform: scale(1.05);
    }
    .cancel-btn {
      background-color: #9ca3af; /* Gray-400 */
      color: white;
      border: none;
      padding: 0.4rem 0.9rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: background-color var(--transition), transform var(--transition);
    }
    .cancel-btn:hover,
    .cancel-btn:focus {
      background-color: #6b7280; /* Gray-600 */
      outline: none;
      transform: scale(1.05);
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 32px;
      }
      h2 {
        font-size: 20px;
      }
      .summary {
        flex-direction: column;
        align-items: center;
      }
      .card {
        max-width: 100%;
        font-size: 16px;
      }
      .chart-tab {
        min-width: 75px;
        font-size: 16px;
        padding: 0.5rem 1rem;
      }
      table.sales-list th, table.sales-list td {
        padding: 0.6rem 0.9rem;
        font-size: 14px;
      }
      .action-btn {
        font-size: 14px;
        padding: 0.2rem 0.5rem;
      }
      button {
        font-size: 16px;
        padding: 0.75rem 1rem;
      }
      .logout-btn {
        max-width: 100px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
<header>
  <nav>
    <div class="logo" tabindex="0">Monthly Sales Tracking</div>
  </nav>
</header>
<main>
  <section class="login-register-container" aria-label="User login and registration section">
    <h1 id="authTitle">Login</h1>
    <div role="tablist" aria-label="Authentication tabs" class="tabs">
      <button role="tab" aria-selected="true" tabindex="0" id="loginTab" class="tab">Login</button>
      <button role="tab" aria-selected="false" tabindex="-1" id="registerTab" class="tab">Register</button>
    </div>
    <form id="login-form" aria-label="Login form" novalidate>
      <label for="login-username">Username</label>
      <input type="text" id="login-username" name="username" required autocomplete="username" autofocus />
      <label for="login-password">Password</label>
      <input type="password" id="login-password" name="password" required autocomplete="current-password" />
      <button type="submit" aria-label="Log in">Log In</button>
    </form>

    <form id="register-form" aria-label="Register form" style="display:none" novalidate>
      <label for="register-username">Username</label>
      <input type="text" id="register-username" name="username" required autocomplete="username" />
      <label for="register-password">Password</label>
      <input type="password" id="register-password" name="password" required autocomplete="new-password" />
      <label for="register-password-confirm">Confirm Password</label>
      <input type="password" id="register-password-confirm" name="passwordConfirm" required autocomplete="new-password" />
      <button type="submit" aria-label="Register account">Register</button>
    </form>
  </section>

  <section class="dashboard" aria-label="Sales dashboard">
    <button class="logout-btn" id="logoutBtn" aria-label="Log out">Log Out</button>
    <h2>Welcome, <span id="userDisplayName"></span>!</h2>
    <form id="sales-form" aria-label="Add new sale" novalidate>
      <h2>Add New Sale</h2>
      <label for="product">Product</label>
      <input type="text" id="product" name="product" required />
      <label for="price">Price (RM)</label>
      <input type="number" id="price" name="price" min="0.01" step="0.01" required />
      <label for="date">Date</label>
      <input type="date" id="date" name="date" required />
      <button type="submit" aria-label="Add sale">Add</button>
    </form>

    <section class="summary" aria-label="Monthly sales summary">
      <div class="card">
        <h3>Total Sales</h3>
        <p id="totalSales">RM&nbsp;0.00</p>
      </div>
      <div class="card">
        <h3>Number of Transactions</h3>
        <p id="numTransactions">0</p>
      </div>
      <div class="card">
        <h3>Average Sale Price</h3>
        <p id="avgPrice">RM&nbsp;0.00</p>
      </div>
    </section>

    <!-- Sales List Table for Edit/Delete -->
    <section class="sales-list-card" aria-label="Sales list">
      <h2>Sales List</h2>
      <table class="sales-list" role="grid" aria-describedby="salesListDescription">
        <caption id="salesListDescription" class="text-muted" style="text-align:left; margin-bottom:0.5rem;">
          List of all your sales transactions with edit and delete options.
        </caption>
        <thead>
          <tr>
            <th scope="col">Product</th>
            <th scope="col">Price (RM)</th>
            <th scope="col">Date</th>
            <th scope="col" style="min-width:110px;">Actions</th>
          </tr>
        </thead>
        <tbody id="salesListBody">
          <!-- Populated dynamically -->
        </tbody>
      </table>
    </section>

    <section class="chart-section" aria-label="Sales charts section">
      <div role="tablist" aria-label="Chart type tabs" class="chart-tabs">
        <button role="tab" aria-selected="true" tabindex="0" id="dailyTab" class="chart-tab">Daily</button>
        <button role="tab" aria-selected="false" tabindex="-1" id="monthlyTab" class="chart-tab">Monthly</button>
        <button role="tab" aria-selected="false" tabindex="-1" id="yearlyTab" class="chart-tab">Yearly</button>
      </div>
      <canvas id="salesChart" aria-label="Sales chart"></canvas>
    </section>
  </section>
</main>
<footer aria-label="Website footer">
  &copy; 2024 Developer Zuu Caster
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script>
(() => {
  const USERS_KEY = 'trackingSales_users';
  const SALES_DATA_KEY = 'trackingSales_sales';

  const loginRegisterContainer = document.querySelector('.login-register-container');
  const loginForm = document.getElementById('login-form');
  const registerForm = document.getElementById('register-form');
  const loginTab = document.getElementById('loginTab');
  const registerTab = document.getElementById('registerTab');
  const authTitle = document.getElementById('authTitle');

  const dashboard = document.querySelector('.dashboard');
  const userDisplayName = document.getElementById('userDisplayName');
  const logoutBtn = document.getElementById('logoutBtn');

  const salesForm = document.getElementById('sales-form');
  const totalSalesEl = document.getElementById('totalSales');
  const numTransactionsEl = document.getElementById('numTransactions');
  const avgPriceEl = document.getElementById('avgPrice');
  const salesChartCtx = document.getElementById('salesChart').getContext('2d');

  const dailyTab = document.getElementById('dailyTab');
  const monthlyTab = document.getElementById('monthlyTab');
  const yearlyTab = document.getElementById('yearlyTab');
  const chartTabs = [dailyTab, monthlyTab, yearlyTab];

  const salesListBody = document.getElementById('salesListBody');

  let currentUser = null;
  let salesData = [];
  let chartInstance = null;
  let currentChartType = 'daily';
  let editingId = null;

  function loadUsers() {
    const usersRaw = localStorage.getItem(USERS_KEY);
    return usersRaw ? JSON.parse(usersRaw) : {};
  }
  function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  function loadSalesData() {
    if (!currentUser) return [];
    const allSalesRaw = localStorage.getItem(SALES_DATA_KEY);
    if (!allSalesRaw) return [];
    const allSales = JSON.parse(allSalesRaw);
    return allSales[currentUser] || [];
  }
  function saveSalesData(sales) {
    if (!currentUser) return;
    const allSalesRaw = localStorage.getItem(SALES_DATA_KEY);
    const allSales = allSalesRaw ? JSON.parse(allSalesRaw) : {};
    allSales[currentUser] = sales;
    localStorage.setItem(SALES_DATA_KEY, JSON.stringify(allSales));
  }

  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }

  function switchToLogin() {
    loginTab.setAttribute('aria-selected', 'true');
    loginTab.tabIndex = 0;
    registerTab.setAttribute('aria-selected', 'false');
    registerTab.tabIndex = -1;
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    authTitle.textContent = 'Login';
    clearRegisterFormErrors();
  }
  function switchToRegister() {
    loginTab.setAttribute('aria-selected', 'false');
    loginTab.tabIndex = -1;
    registerTab.setAttribute('aria-selected', 'true');
    registerTab.tabIndex = 0;
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    authTitle.textContent = 'Register';
    clearLoginFormErrors();
  }

  loginTab.addEventListener('click', () => { switchToLogin(); });
  registerTab.addEventListener('click', () => { switchToRegister(); });

  loginTab.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
      e.preventDefault();
      registerTab.focus();
      switchToRegister();
    }
  });
  registerTab.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
      e.preventDefault();
      loginTab.focus();
      switchToLogin();
    }
  });

  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    clearLoginFormErrors();

    const username = loginForm.username.value.trim();
    const password = loginForm.password.value;

    if (!username || !password) {
      alert('Please enter username and password.');
      return;
    }

    const users = loadUsers();
    if (!users[username]) {
      alert('User does not exist. Please register.');
      return;
    }
    if (users[username] !== password) {
      alert('Incorrect password.');
      return;
    }

    loginSuccess(username);
  });

  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    clearRegisterFormErrors();

    const username = registerForm.username.value.trim();
    const password = registerForm.password.value;
    const passwordConfirm = registerForm.passwordConfirm.value;

    if (!username || !password || !passwordConfirm) {
      alert('Please fill all fields.');
      return;
    }
    if (password !== passwordConfirm) {
      alert('Passwords do not match.');
      return;
    }

    const users = loadUsers();
    if (users[username]) {
      alert('Username already taken. Please choose another.');
      return;
    }

    users[username] = password;
    saveUsers(users);
    alert('Registration successful! Please log in.');
    switchToLogin();
    loginForm.username.value = username;
    loginForm.password.value = '';
    loginForm.username.focus();
  });

  function clearLoginFormErrors() {}
  function clearRegisterFormErrors() {}

  function loginSuccess(username) {
    currentUser = username;
    loginRegisterContainer.style.display = 'none';
    dashboard.style.display = 'flex';
    userDisplayName.textContent = username;
    currentChartType = 'monthly';
    updateChartTabsSelection();
    loadAndRenderSales();
    saveCurrentUser();
  }

  logoutBtn.addEventListener('click', () => { logout(); });
  function logout() {
    currentUser = null;
    salesData = [];
    editingId = null;
    loginRegisterContainer.style.display = 'flex';
    dashboard.style.display = 'none';
    loginForm.reset();
    registerForm.reset();
    switchToLogin();
    clearLoginFormErrors();
    clearRegisterFormErrors();
    saveCurrentUser();
  }

  salesForm.addEventListener('submit', e => {
    e.preventDefault();
    if(editingId !== null) {
      alert('Please save or cancel the current edit first.');
      return;
    }
    const product = salesForm.product.value.trim();
    const price = parseFloat(salesForm.price.value);
    const date = salesForm.date.value;

    if (!product || isNaN(price) || price <= 0 || !date) {
      alert('Please enter valid product, price (> 0), and date.');
      return;
    }

    const sale = { id: generateId(), product, price, date };
    salesData.push(sale);
    saveSalesData(salesData);
    salesForm.reset();

    loadAndRenderSales();
  });

  dailyTab.addEventListener('click', () => { setChartTab('daily'); });
  monthlyTab.addEventListener('click', () => { setChartTab('monthly'); });
  yearlyTab.addEventListener('click', () => { setChartTab('yearly'); });

  chartTabs.forEach((tab, i) => {
    tab.addEventListener('keydown', e => {
      if (['ArrowLeft', 'ArrowUp'].includes(e.key)) {
        e.preventDefault();
        const prevIndex = (i - 1 + chartTabs.length) % chartTabs.length;
        chartTabs[prevIndex].focus();
        chartTabs[prevIndex].click();
      } else if (['ArrowRight', 'ArrowDown'].includes(e.key)) {
        e.preventDefault();
        const nextIndex = (i + 1) % chartTabs.length;
        chartTabs[nextIndex].focus();
        chartTabs[nextIndex].click();
      }
    });
  });

  function setChartTab(type) {
    if (currentChartType !== type) {
      currentChartType = type;
      updateChartTabsSelection();
      updateChart(salesData);
    }
  }
  function updateChartTabsSelection() {
    chartTabs.forEach(tab => {
      tab.setAttribute('aria-selected', tab.id.startsWith(currentChartType) ? 'true' : 'false');
      tab.tabIndex = tab.getAttribute('aria-selected') === 'true' ? 0 : -1;
    });
  }

  function loadAndRenderSales() {
    salesData = loadSalesData();

    updateSummary(salesData);
    updateChart(salesData);
    renderSalesList();
  }

  function updateSummary(sales) {
    const total = sales.reduce((acc, s) => acc + s.price, 0);
    const count = sales.length;
    const avg = count ? total / count : 0;

    totalSalesEl.textContent = `RM\u00A0${total.toFixed(2)}`;
    numTransactionsEl.textContent = count.toString();
    avgPriceEl.textContent = `RM\u00A0${avg.toFixed(2)}`;
  }

  function groupSalesBy(sales, period) {
    const grouped = {};
    sales.forEach(({ price, date }) => {
      let key;
      if (period === 'daily') {
        key = date;
      } else if (period === 'monthly') {
        key = date.slice(0,7);
      } else if (period === 'yearly') {
        key = date.slice(0,4);
      }
      grouped[key] = (grouped[key] || 0) + price;
    });
    return grouped;
  }

  function updateChart(sales) {
    const period = currentChartType;
    const groupedData = groupSalesBy(sales, period);

    const keys = Object.keys(groupedData).sort();

    let labels = [];
    if (period === 'daily') {
      labels = keys.map(k => {
        const d = new Date(k + 'T00:00:00');
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });
    } else if (period === 'monthly') {
      labels = keys.map(k => {
        const [year, month] = k.split('-');
        const d = new Date(year, month - 1);
        return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
      });
    } else if (period === 'yearly') {
      labels = keys;
    }

    const values = keys.map(k => groupedData[k]);

    if (chartInstance) {
      chartInstance.data.labels = labels;
      chartInstance.data.datasets[0].data = values;
      chartInstance.data.datasets[0].label = `Sales (${capitalize(period)}) (RM)`;
      chartInstance.update();
    } else {
      chartInstance = new Chart(salesChartCtx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `Sales (${capitalize(period)}) (RM)`,
            data: values,
            borderColor: '#111827',
            backgroundColor: 'rgba(17, 24, 39, 0.1)',
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointHoverRadius: 6,
          }],
        },
        options: {
          responsive: true,
          interaction: {
            mode: 'nearest',
            intersect: false,
          },
          scales: {
            x: {
              ticks: {
                color: '#374151',
                maxRotation: 45,
                minRotation: 45,
                autoSkip: true,
                maxTicksLimit: 12,
              },
              title: {
                display: true,
                text: period === "daily" ? 'Date' : (period === 'monthly' ? 'Month' : 'Year'),
                color: '#374151',
                font: {weight: '600', size: 14}
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: '#374151',
                callback: function(value) {
                  return 'RM ' + value.toFixed(2);
                }
              },
              title: {
                display: true,
                text: 'Sales (RM)',
                color: '#374151',
                font: {weight: '600', size: 14}
              }
            },
          },
          plugins: {
            legend: {
              display: true,
              labels: {
                color: '#374151',
                font: {
                  weight: '600',
                  size: 14,
                },
              },
            },
            tooltip: {
              enabled: true,
              callbacks: {
                label: context => `RM ${context.parsed.y?.toFixed(2) ?? 0}`,
              }
            },
          },
        },
      });
    }
  }

  function capitalize(s) {
    return s.charAt(0).toUpperCase() + s.slice(1);
  }

  function renderSalesList() {
    salesListBody.innerHTML = '';
    salesData.forEach(sale => {
      const tr = document.createElement('tr');
      tr.setAttribute('data-id', sale.id);

      if(editingId === sale.id) {
        tr.innerHTML = `
          <td>
            <input class="edit-input" type="text" value="${escapeHtml(sale.product)}" aria-label="Edit Product" />
          </td>
          <td>
            <input class="edit-input" type="number" step="0.01" min="0.01" value="${sale.price.toFixed(2)}" aria-label="Edit Price (RM)" />
          </td>
          <td>
            <input class="edit-input" type="date" value="${sale.date}" aria-label="Edit Date" />
          </td>
          <td class="edit-actions">
            <button class="save-btn" aria-label="Save changes">Save</button>
            <button class="cancel-btn" aria-label="Cancel edit">Cancel</button>
          </td>
        `;
        const saveBtn = tr.querySelector('.save-btn');
        const cancelBtn = tr.querySelector('.cancel-btn');
        saveBtn.addEventListener('click', () => saveEdit(sale.id, tr));
        cancelBtn.addEventListener('click', () => cancelEdit());
      } else {
        tr.innerHTML = `
          <td>${escapeHtml(sale.product)}</td>
          <td>RM&nbsp;${sale.price.toFixed(2)}</td>
          <td>${sale.date}</td>
          <td>
            <button class="action-btn" aria-label="Edit this item" title="Edit">‚úèÔ∏è</button>
            <button class="action-btn" aria-label="Delete this item" title="Delete">üóëÔ∏è</button>
          </td>
        `;
        const editBtn = tr.querySelector('.action-btn[aria-label="Edit this item"]');
        const deleteBtn = tr.querySelector('.action-btn[aria-label="Delete this item"]');

        editBtn.addEventListener('click', () => startEdit(sale.id));
        deleteBtn.addEventListener('click', () => deleteSale(sale.id));
      }
      salesListBody.appendChild(tr);
    });
  }

  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
    });
  }

  function startEdit(id) {
    if(editingId !== null) {
      alert('Please save or cancel the current edit first.');
      return;
    }
    editingId = id;
    renderSalesList();
    salesForm.querySelectorAll('input, button').forEach(el => el.disabled = true);
  }

  function cancelEdit() {
    editingId = null;
    renderSalesList();
    salesForm.querySelectorAll('input, button').forEach(el => el.disabled = false);
  }

  function saveEdit(id, tr) {
    const inputs = tr.querySelectorAll('input');
    const newProduct = inputs[0].value.trim();
    const newPrice = parseFloat(inputs[1].value);
    const newDate = inputs[2].value;

    if (!newProduct) {
      alert('Please enter a product name.');
      return;
    }
    if (isNaN(newPrice) || newPrice <= 0) {
      alert('Please enter a valid price greater than 0.');
      return;
    }
    if (!newDate) {
      alert('Please enter a valid date.');
      return;
    }

    const index = salesData.findIndex(s => s.id === id);
    if (index !== -1) {
      salesData[index].product = newProduct;
      salesData[index].price = newPrice;
      salesData[index].date = newDate;
      saveSalesData(salesData);
      editingId = null;
      renderSalesList();
      updateSummary(salesData);
      updateChart(salesData);
      salesForm.querySelectorAll('input, button').forEach(el => el.disabled = false);
    }
  }

  function deleteSale(id) {
    if(editingId !== null) {
      alert('Please save or cancel the current edit first.');
      return;
    }
    if(confirm('Are you sure you want to delete this sale?')) {
      salesData = salesData.filter(s => s.id !== id);
      saveSalesData(salesData);
      renderSalesList();
      updateSummary(salesData);
      updateChart(salesData);
    }
  }

  const storedUser = sessionStorage.getItem('trackingSales_currentUser');
  if (storedUser) {
    currentUser = storedUser;
    loginRegisterContainer.style.display = 'none';
    dashboard.style.display = 'flex';
    userDisplayName.textContent = currentUser;
    currentChartType = 'monthly';
    updateChartTabsSelection();
    loadAndRenderSales();
  } else {
    switchToLogin();
    loginRegisterContainer.style.display = 'flex';
    dashboard.style.display = 'none';
  }

  function saveCurrentUser() {
    if (currentUser) {
      sessionStorage.setItem('trackingSales_currentUser', currentUser);
    } else {
      sessionStorage.removeItem('trackingSales_currentUser');
    }
  }
})();
</script>
<footer aria-label="Website footer">
  &copy; 2024 Developer Zuu Caster
</footer>
</body>
</html>

